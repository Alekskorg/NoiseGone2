<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1.0">
  <title>NoiseGone</title>
  <style>
    /* Сброс */
    * { box-sizing:border-box; margin:0; padding:0; }
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg,#e0f3ff,#f3e0ff);
      min-height:100vh;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .container {
      background:#fff;
      border-radius:1.5rem;
      padding:2.5rem;
      box-shadow:0 8px 24px rgba(0,0,0,0.1);
      width:90%;
      max-width:400px;
      position:relative;
      text-align:center;
    }
    #langBtn {
      position:absolute;
      top:1rem; right:1rem;
      background:#fff;
      border:none;
      padding:0.5rem 0.75rem;
      border-radius:999px;
      cursor:pointer;
      box-shadow:0 2px 4px rgba(0,0,0,0.15);
      font-weight:bold;
    }
    header img {
      max-width:80px;
      margin-bottom:1rem;
    }
    header h1 {
      font-size:1.75rem;
      margin-bottom:0.5rem;
    }
    header p.desc {
      color:#555;
      margin-bottom:1.5rem;
    }
    .presets {
      display:flex;
      justify-content:center;
      gap:0.5rem;
      margin-bottom:1rem;
    }
    .presets .preset {
      padding:0.5rem 0.75rem;
      border-radius:0.5rem;
      border:1px solid #ccc;
      background:#fff;
      cursor:pointer;
      flex:1;
    }
    .presets .preset.active {
      background:#2563eb;
      color:#fff;
      border-color:#2563eb;
    }
    .drop-area {
      border:2px dashed #8faad2;
      border-radius:0.75rem;
      padding:1.5rem;
      margin-bottom:1rem;
      cursor:pointer;
    }
    .drop-area p {
      margin-bottom:0.25rem;
    }
    #processBtn {
      background:#34a853;
      color:#fff;
      border:none;
      padding:0.75rem 1.25rem;
      border-radius:2rem;
      font-size:1rem;
      cursor:pointer;
      width:100%;
      margin-bottom:0.75rem;
    }
    #progress {
      width:100%;
      height:0.5rem;
      border-radius:0.25rem;
      overflow:hidden;
      margin-bottom:0.75rem;
    }
    #download {
      display:none;
      color:#2563eb;
      text-decoration:none;
      font-weight:bold;
    }
    .small {
      font-size:0.875rem;
      color:#666;
    }
  </style>
</head>
<body>
  <div class="container">
    <button id="langBtn">EN</button>
    <header>
      <img src="logo.png" alt="NoiseGone Logo">
      <h1>NoiseGone</h1>
      <p class="desc"></p>
    </header>
    <div class="presets">
      <button class="preset active" data-preset="podcast"></button>
      <button class="preset" data-preset="interview"></button>
      <button class="preset" data-preset="voiceover"></button>
      <button class="preset" data-preset="field"></button>
    </div>
    <div id="noFile" class="drop-area">
      <p class="hint-title"></p>
      <p class="hint-sub"></p>
      <input type="file" id="fileInput" accept="audio/*" style="display:none">
    </div>
    <div id="withFile" class="drop-area" style="display:none">
      <p class="hint-title"></p>
      <p class="hint-sub"></p>
    </div>
    <button id="processBtn"></button>
    <progress id="progress" value="0" max="100" style="display:none"></progress>
    <a id="download" href="#" download="cleaned.mp3">Скачать очищенный файл</a>
    <p class="small"></p>
  </div>

  <script>
    // --- Тексты для локализации ---
    const texts = {
      ru: {
        title: 'NoiseGone',
        desc: 'Загрузите аудиофайл, и мы удалим шум',
        hints: {
          noFile: 'Перетащите аудио сюда или нажмите, чтобы выбрать',
          sub: 'Поддерживаемые форматы: WAV, MP3, M4A • до ~50 МБ',
          hasFile: 'Файл выбран',
          replace: 'Вы можете перетащить другой файл, чтобы заменить'
        },
        btnProcess: 'Очистить шум',
        done: 'Готово!',
        podcast: 'Podcast',
        interview: 'Interview',
        voiceover: 'Voice-over',
        field: 'Field',
        planInfo: 'Бесплатно — до 5 минут/день. Для больших объёмов будет поминутная оплата.',
        download: 'Скачать очищенный файл'
      },
      en: {
        title: 'NoiseGone',
        desc: 'Upload an audio file and we’ll remove the noise',
        hints: {
          noFile: 'Drag audio here or click to select',
          sub: 'Supported: WAV, MP3, M4A • up to ~50 MB',
          hasFile: 'File ready',
          replace: 'You can drop another file to replace'
        },
        btnProcess: 'Clean noise',
        done: 'Done!',
        podcast: 'Podcast',
        interview: 'Interview',
        voiceover: 'Voice-over',
        field: 'Field',
        planInfo: 'Free — up to 5 minutes/day. Large volume billed per minute.',
        download: 'Download clean file'
      }
    };
    let currentLang = 'ru';

    // --- Элементы страницы ---
    const langBtn     = document.getElementById('langBtn');
    const desc        = document.querySelector('header p.desc');
    const presets     = document.querySelectorAll('.preset');
    const noFileArea  = document.getElementById('noFile');
    const withFileArea= document.getElementById('withFile');
    const hintTitle   = () => document.querySelector('.drop-area .hint-title');
    const hintSub     = () => document.querySelector('.drop-area .hint-sub');
    const fileInput   = document.getElementById('fileInput');
    const processBtn  = document.getElementById('processBtn');
    const progressBar = document.getElementById('progress');
    const download    = document.getElementById('download');
    const smallText   = document.querySelector('.small');

    // --- Применяем локализацию к элементам ---
    function applyLocale() {
      const L = texts[currentLang];
      langBtn.textContent = currentLang.toUpperCase();
      document.querySelector('header h1').textContent = L.title;
      desc.textContent = L.desc;
      hintTitle().textContent = L.hints.noFile;
      hintSub().textContent   = L.hints.sub;
      presets.forEach(btn => {
        const key = btn.dataset.preset;
        btn.textContent = L[key];
      });
      processBtn.textContent = L.btnProcess;
      smallText.textContent  = L.planInfo;
      download.textContent   = L.download;
    }

    // --- Переключатель языка ---
    langBtn.addEventListener('click', () => {
      currentLang = currentLang === 'ru' ? 'en' : 'ru';
      applyLocale();
    });

    // --- Выбор пресета (не влияет на логику бэкенда сейчас) ---
    presets.forEach(btn => {
      btn.addEventListener('click', () => {
        presets.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
      });
    });

    // --- Обработка drag&drop и клика для выбора файла ---
    function showWithFile(name) {
      noFileArea.style.display = 'none';
      withFileArea.style.display = 'block';
      hintTitle().textContent = texts[currentLang].hints.hasFile;
      hintSub().textContent   = texts[currentLang].hints.replace;
    }
    noFileArea.addEventListener('click', ()=> fileInput.click());
    noFileArea.addEventListener('dragover', e=>{ e.preventDefault(); });
    noFileArea.addEventListener('drop', e=>{
      e.preventDefault();
      fileInput.files = e.dataTransfer.files;
      handleFile();
    });
    fileInput.addEventListener('change', handleFile);

    function handleFile() {
      if (!fileInput.files.length) return;
      showWithFile(fileInput.files[0].name);
    }

    // --- Отправка на сервер и отображение прогресса ---
    processBtn.addEventListener('click', ()=>{
      if (!fileInput.files.length) return;
      processBtn.disabled = true;
      progressBar.style.display = 'block';
      download.style.display = 'none';

      const form = new FormData();
      form.append('file', fileInput.files[0]);
      form.append('preset', document.querySelector('.preset.active').dataset.preset);

      const xhr = new XMLHttpRequest();
      xhr.open('POST','/api/clean');
      xhr.responseType = 'blob';

      xhr.upload.onprogress = e => {
        if (e.lengthComputable) {
          const pct = Math.round(e.loaded/e.total*100);
          progressBar.value = pct;
        }
      };

      xhr.onload = () => {
        if (xhr.status === 200) {
          // создаём ссылку на blob
          const url = URL.createObjectURL(xhr.response);
          download.href = url;
          // переключаем кнопку на «Готово» и показываем ссылку загрузки
          processBtn.textContent = texts[currentLang].done;
          download.style.display = 'inline-block';
        } else {
          alert('Ошибка обработки: '+xhr.status);
        }
        processBtn.disabled = false;
      };

      xhr.send(form);
    });

    // --- Инициализация страницы ---
    applyLocale();
  </script>
</body>
</html>


