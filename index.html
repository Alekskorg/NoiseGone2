<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>NoiseGone — очистка аудио от шума</title>
<link rel="icon" href="/favicon.ico" />
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet"/>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  :root{
    --grad-a:#eaf3ff;--grad-b:#f3ebff;--card:#fff;
    --radius:32px;--shadow:0 18px 48px rgba(21,27,45,.12);
    --primary:#2ecc71;--accent:#263fa2;--text:#222;--muted:#667085;
    --dash:#c8d3ff;
  }
  body{
    min-height:100vh;background:linear-gradient(135deg,var(--grad-a),var(--grad-b));
    font-family:'Inter',sans-serif;color:var(--text);display:flex;align-items:center;justify-content:center;padding:28px;
  }
  .card{
    position:relative;max-width:600px;width:100%;
    background:var(--card);border-radius:28px;box-shadow:var(--shadow);
    padding:40px 32px;text-align:center;
  }
  .lang{position:absolute;top:16px;right:16px;background:#fff;border:none;padding:6px 12px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,.08);cursor:pointer;font-weight:600}
  .logo{height:96px;margin-bottom:8px;opacity:.95}
  @media (max-width:520px){ .logo{height:72px} }

  h1{margin:0 0 6px;font-size:36px;letter-spacing:.2px}
  p.desc{color:var(--muted);margin-bottom:18px}

  .preset{display:flex;gap:8px;flex-wrap:wrap;justify-content:center;margin-bottom:14px}
  .preset button{border:1px solid #e5e7ef;background:#fafbff;padding:8px 12px;border-radius:12px;cursor:pointer}
  .preset button.active{border-color:var(--accent);color:#fff;background:var(--accent)}

  .drop{
    border:2px dashed var(--dash);border-radius:20px;background:#f7f9ff;
    min-height:200px;display:flex;align-items:center;justify-content:center;flex-direction:column;
    padding:22px;margin:18px 0 14px;transition:all .2s ease;
  }
  .drop.drag{background:#eef3ff;border-color:#7e96ff}
  .drop .icon{width:56px;height:56px;opacity:.75;margin-bottom:12px}
  .drop .hint-title{font-weight:600;margin-bottom:6px}
  .drop .hint-sub{color:var(--muted);font-size:.95rem}
  .drop .file-name{margin-top:8px;font-weight:600}

  .upload-label{color:#304ffe;text-decoration:underline;cursor:pointer}
  .upload-label input{display:none}

  .action{display:flex;gap:12px;justify-content:center;align-items:center;margin:8px 0 10px}
  .btn{background:var(--primary);color:#fff;border:none;padding:12px 20px;border-radius:24px;cursor:pointer;font-weight:600}
  .btn[disabled]{opacity:.6;cursor:not-allowed}

  .progress{height:8px;background:#eef0f6;border-radius:8px;overflow:hidden;margin:8px 0}
  .bar{height:100%;width:0;background:var(--primary);transition:width .2s}

  .ab{display:flex;gap:12px;justify-content:center;margin-top:10px}
  .ab button{border:1px solid #e5e7ef;background:#fff;padding:6px 12px;border-radius:12px;cursor:pointer}

  audio{width:100%;margin:10px 0}
  .small{color:var(--muted);font-size:.92rem;margin-top:10px}
</style>
</head>
<body>
  <div class="card">
    <button class="lang" id="langBtn">EN</button>

    <header>
      <img class="logo" src="logo.png" alt="NoiseGone" />
      <h1>NoiseGone</h1>
      <p class="desc">Загрузите аудиофайл, и мы удалим шум</p>
    </header>

    <div class="preset" id="presetBox">
      <button data-preset="podcast" class="active">Podcast</button>
      <button data-preset="interview">Interview</button>
      <button data-preset="voiceover">Voice‑over</button>
      <button data-preset="field">Field</button>
    </div>

    <div class="drop" id="drop">
      <div id="noFile" style="text-align:center">
        <svg class="icon" viewBox="0 0 24 24" fill="none">
          <path d="M12 16V4m0 0l-3.5 3.5M12 4l3.5 3.5" stroke="#667085" stroke-width="1.6" stroke-linecap="round" stroke-linejoin="round"/>
          <rect x="3" y="14" width="18" height="6" rx="3" stroke="#667085" stroke-width="1.6" />
        </svg>
        <div class="hint-title">Перетащите аудио сюда или <label class="upload-label">нажмите, чтобы выбрать<input id="fileInput" type="file" accept="audio/*"/></label></div>
        <div class="hint-sub">Поддерживаемые форматы: WAV, MP3, M4A • до ~50&nbsp;МБ</div>
      </div>

      <div id="withFile" style="display:none">
        <div class="hint-title">Файл выбран</div>
        <div class="file-name" id="fileName"></div>
        <div class="hint-sub">Вы можете перетащить другой файл, чтобы заменить</div>
      </div>
    </div>

    <div class="action">
      <button class="btn" id="processBtn" disabled>Очистить шум</button>
      <span id="percent"></span>
    </div>
    <div class="progress"><div class="bar" id="bar"></div></div>

    <div id="players" style="display:none">
      <div class="ab">
        <button id="btnBefore">До</button>
        <button id="btnAfter">После</button>
        <a id="download" class="btn" href="#" download="cleaned.mp3">Скачать очищенный файл</a>
      </div>
      <audio id="before" controls></audio>
      <audio id="after"  controls></audio>
    </div>

    <p class="small">Бесплатно — до 5 минут/день. Для больших объёмов будет поминутная оплата.</p>
  </div>

<script>
(() => {
  const drop = document.getElementById('drop');
  const fileInput = document.getElementById('fileInput');
  const fileName = document.getElementById('fileName');
  const noFile = document.getElementById('noFile');
  const withFile = document.getElementById('withFile');
  const processBtn = document.getElementById('processBtn');
  const bar = document.getElementById('bar');
  const percent = document.getElementById('percent');
  const before = document.getElementById('before');
  const after = document.getElementById('after');
  const players = document.getElementById('players');
  const download = document.getElementById('download');
  const presetBox = document.getElementById('presetBox');

  let currentFile = null;
  let preset = 'podcast';

  presetBox.addEventListener('click', (e) => {
    const b = e.target.closest('button[data-preset]');
    if (!b) return;
    preset = b.dataset.preset;
    [...presetBox.children].forEach(x => x.classList.remove('active'));
    b.classList.add('active');
  });

  ['dragenter','dragover'].forEach(ev =>
    drop.addEventListener(ev, e => { e.preventDefault(); drop.classList.add('drag'); })
  );
  ['dragleave','drop'].forEach(ev =>
    drop.addEventListener(ev, e => { e.preventDefault(); drop.classList.remove('drag'); })
  );
  drop.addEventListener('drop', e => {
    const f = e.dataTransfer.files?.[0];
    if (!f) return;
    setFile(f);
  });

  fileInput.addEventListener('change', e => {
    const f = e.target.files?.[0];
    if (f) setFile(f);
  });

  function setFile(f) {
    currentFile = f;
    fileName.textContent = f.name;
    before.src = URL.createObjectURL(f);
    noFile.style.display = 'none';
    withFile.style.display = '';
    processBtn.disabled = false;
    players.style.display = 'none';
    bar.style.width = '0%';
    percent.textContent = '';
  }

  processBtn.addEventListener('click', async () => {
    if (!currentFile) return;
    processBtn.disabled = true;

    const form = new FormData();
    form.append('audio', currentFile);
    form.append('preset', preset);

    const xhr = new XMLHttpRequest();
    xhr.open('POST', '/api/clean', true);

    xhr.upload.onprogress = (e) => {
      if (e.lengthComputable) {
        const p = Math.round((e.loaded / e.total) * 100);
        bar.style.width = p + '%';
        percent.textContent = p + '%';
      }
    };

    xhr.responseType = 'blob';
    xhr.onload = () => {
      if (xhr.status === 200) {
        const blob = xhr.response;
        const url = URL.createObjectURL(blob);
        after.src = url;
        download.href = url;
        players.style.display = '';
        percent.textContent = '100%';
        bar.style.width = '100%';
      } else {
        alert('Ошибка обработки');
      }
      processBtn.disabled = false;
    };
    xhr.onerror = () => {
      alert('Сетевая ошибка');
      processBtn.disabled = false;
    };
    xhr.send(form);
  });

  document.getElementById('btnBefore').addEventListener('click', () => {
    after.pause(); after.currentTime = 0;
    before.currentTime = 0; before.play();
  });
  document.getElementById('btnAfter').addEventListener('click', () => {
    before.pause(); before.currentTime = 0;
    after.currentTime = 0; after.play();
  });
})();
</script>
</body>
</html>


