<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0" />
<title>NoiseGone — очистка аудио от шума</title>
<meta name="description" content="NoiseGone — удаление фонового шума из аудио прямо в браузере. Поддержка WAV, MP3, M4A. Бесплатно до 5 минут в день." />
<link rel="icon" href="favicon.ico">

<style>
  *{box-sizing:border-box}
  body{
    margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
    background:radial-gradient(1200px 800px at 20% 0%, #e5f2ff 0, transparent 60%),
               radial-gradient(1200px 800px at 100% 100%, #efe5ff 0, transparent 60%),
               linear-gradient(135deg,#eef7ff,#f5efff);
    font-family:system-ui, Segoe UI, Arial, sans-serif;color:#0f172a
  }
  .card{
    background:#fff;border-radius:20px;box-shadow:0 20px 60px rgba(15,23,42,.08);
    width:min(92vw,560px);padding:28px 28px 24px;position:relative;text-align:center
  }
  #langBtn{
    position:absolute;top:12px;right:12px;border:0;background:#f7f7f7;border-radius:12px;
    padding:6px 10px;cursor:pointer;box-shadow:0 2px 4px rgba(0,0,0,.08);font-weight:600
  }
  .logo{width:120px;margin:6px auto 8px;display:block;opacity:.95}
  h1{font-size:32px;margin:0 0 6px}
  .desc{color:#475569;margin:0 0 18px}
  .modes{display:flex;gap:10px;justify-content:center;margin:0 0 14px;flex-wrap:wrap}
  .modes button{
    padding:9px 14px;border:1px solid #d7dbe7;border-radius:12px;background:#fff;cursor:pointer
  }
  .modes button.active{background:#2563eb;color:#fff;border-color:#2563eb}
  .drop{
    border:2px dashed #a6b7e6;border-radius:14px;padding:18px;margin:10px 0 16px;cursor:pointer;
    transition:.15s;position:relative
  }
  .drop.hover{background:#eef6ff;border-color:#2563eb}
  .file-line{display:flex;align-items:center;gap:10px;justify-content:center;color:#111827;flex-wrap:wrap}
  .file-name{max-width:320px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
  .file-size{color:#64748b;font-size:12px}
  .hint-top{font-weight:600;margin-bottom:4px}
  .hint-sub{color:#64748b;font-size:13px}
  .btn{display:inline-block;border:0;border-radius:999px;padding:13px 18px;font-size:16px;cursor:pointer}
  #processBtn{width:100%;background:#22c55e;color:#fff;margin:8px 0 12px}
  #processBtn:disabled{opacity:.6;cursor:not-allowed}
  #newBtn{display:none;background:#eef2ff;color:#111827;margin-left:0}
  .bar-wrap{height:8px;background:#e8edf7;border-radius:6px;overflow:hidden;margin:10px 0 8px;pointer-events:none}
  .bar{height:100%;width:0;background:#22c55e;transition:width .2s}
  .status{min-height:20px;font-size:14px;color:#0f172a}
  .err{color:#dc2626}
  #download{display:none;margin-top:8px}
  #download a{color:#2563eb;font-weight:700;text-decoration:none}
  .small{font-size:13px;color:#64748b;margin-top:10px}
</style>
</head>
<body>
  <div class="card">
    <button id="langBtn">EN</button>
    <img class="logo" src="logo.png" alt="NoiseGone logo">
    <h1>NoiseGone</h1>
    <p class="desc">Загрузите аудиофайл, и мы удалим шум</p>

    <div class="modes" id="modes">
      <button class="active" data-preset="podcast">Podcast</button>
      <button data-preset="interview">Interview</button>
      <button data-preset="voiceover">Voice‑over</button>
      <button data-preset="field">Field</button>
    </div>

    <div id="drop" class="drop" role="button" tabindex="0" aria-label="file drop zone">
      <div class="hint-top">Перетащите аудио сюда или нажмите, чтобы выбрать</div>
      <div class="hint-sub">Поддерживаемые: WAV, MP3, M4A (до ~50 МБ)</div>
    </div>
    <input id="file" type="file" accept="audio/*" style="display:none">

    <div>
      <button id="processBtn" class="btn">Очистить шум</button>
      <button id="newBtn" class="btn">Новый файл</button>
    </div>

    <div class="bar-wrap"><div class="bar" id="bar"></div></div>
    <div class="status" id="status"></div>

    <div id="download"><a id="dl" href="#" download="cleaned.wav">Скачать очищенный файл</a></div>
    <p class="small" id="plan">Бесплатно — до 5 минут/день. Для больших объёмов будет поминутная оплата.</p>
  </div>

  <!-- UMD-версия FFmpeg: без ES-модулей -->
  <script defer src="https://unpkg.com/@ffmpeg/ffmpeg@0.12.10/dist/ffmpeg.min.js"></script>

  <script>
  document.addEventListener('DOMContentLoaded', function(){
    // Если FFmpeg не загрузился — покажем подсказку
    const ffmpegNS = window.FFmpeg;
    const statusEl = document.getElementById('status');
    const bar = document.getElementById('bar');
    if (!ffmpegNS) {
      statusEl.innerHTML = '<span class="err">Не загрузился FFmpeg (CDN). Обновите страницу или проверьте сеть/блокировщики.</span>';
      return;
    }

    const { createFFmpeg, fetchFile } = ffmpegNS;

    const T = {
      ru:{desc:'Загрузите аудиофайл, и мы удалим шум',hintTop:'Перетащите аудио сюда или нажмите, чтобы выбрать',hintSub:'Поддерживаемые: WAV, MP3, M4A (до ~50 МБ)',clean:'Очистить шум', newFile:'Новый файл',free:'Бесплатно — до 5 минут/день. Для больших объёмов будет поминутная оплата.',done:'Готово! Нажмите, чтобы скачать.',downloading:'Скачать очищенный файл',error:'Ошибка обработки',network:'Сетевая ошибка',processing:'Идёт обработка…', preparing:'Подготовка FFmpeg…'},
      en:{desc:"Upload an audio file and we'll remove the noise",hintTop:'Drag & drop audio here or click to choose',hintSub:'Supported: WAV, MP3, M4A (up to ~50 MB)',clean:'Clean noise', newFile:'New file',free:'Free — up to 5 minutes/day. Large volume billed per minute.',done:'Done! Click to download.',downloading:'Download cleaned file',error:'Processing error',network:'Network error',processing:'Processing…', preparing:'Preparing FFmpeg…'}
    };
    let lang='ru', preset='podcast', selectedFile=null;

    const $ = s => document.querySelector(s);
    const desc=$('.desc'), drop=$('#drop'), file=$('#file');
    const processBtn=$('#processBtn'), newBtn=$('#newBtn');
    const downloadWrap=$('#download'), dl=$('#dl');
    const plan=$('#plan'), langBtn=$('#langBtn');
    const modeBtns=[...document.querySelectorAll('.modes button')];

    function applyLang(){
      const L=T[lang];
      langBtn.textContent=(lang==='ru'?'EN':'RU');
      desc.textContent=L.desc;
      if(!selectedFile){
        drop.innerHTML=`<div class="hint-top">${L.hintTop}</div><div class="hint-sub">${L.hintSub}</div>`;
      }
      processBtn.textContent=L.clean; newBtn.textContent=L.newFile; plan.textContent=L.free; dl.textContent=L.downloading;
    }
    langBtn.addEventListener('click', ()=>{ lang=(lang==='ru'?'en':'ru'); applyLang(); });

    modeBtns.forEach(b=>{
      b.addEventListener('click', ()=>{
        modeBtns.forEach(x=>x.classList.remove('active'));
        b.classList.add('active'); preset=b.dataset.preset||'podcast';
      });
    });

    function bytesToSize(bytes){const u=['B','KB','MB','GB'];let i=0,v=bytes;while(v>=1024&&i<u.length-1){v/=1024;i++;}return v.toFixed(1)+' '+u[i];}
    function showFileInfo(){
      if(!selectedFile){applyLang();return;}
      drop.innerHTML=`
        <div class="file-line">
          <svg width="18" height="18" viewBox="0 0 24 24"><path fill="#2563eb" d="M12 3l8 6v12H4V9l8-6zm0 2.3L6 10v9h12v-9l-6-4.7z"/></svg>
          <span class="file-name" title="${selectedFile.name}">${selectedFile.name}</span>
          <span class="file-size">(${bytesToSize(selectedFile.size)})</span>
        </div>
        <div class="hint-sub">${T[lang].hintSub}</div>`;
    }
    function resetUI(){
      processBtn.disabled=true; downloadWrap.style.display='none';
      statusEl.textContent=''; bar.style.width='0%';
      newBtn.style.display='none'; selectedFile=null; file.value=''; applyLang();
    }

    drop.addEventListener('click', ()=>file.click());
    drop.addEventListener('dragover', e=>{e.preventDefault(); drop.classList.add('hover');});
    drop.addEventListener('dragleave', ()=>drop.classList.remove('hover'));
    drop.addEventListener('drop', e=>{
      e.preventDefault(); drop.classList.remove('hover');
      if(e.dataTransfer.files && e.dataTransfer.files[0]){ selectedFile=e.dataTransfer.files[0]; showFileInfo(); processBtn.disabled=false; newBtn.style.display='inline-block'; }
    });
    file.addEventListener('change', ()=>{
      if(file.files[0]){ selectedFile=file.files[0]; showFileInfo(); processBtn.disabled=false; newBtn.style.display='inline-block'; }
    });
    newBtn.addEventListener('click', resetUI);

    // --- FFmpeg (браузер) ---
    const ffmpeg = createFFmpeg({ log: false, corePath: 'https://unpkg.com/@ffmpeg/core@0.12.10/dist/ffmpeg-core.js' });
    async function ensureFFmpegLoaded(){
      if (!ffmpeg.isLoaded()) {
        statusEl.textContent = T[lang].preparing;
        let pct = 0; const timer = setInterval(()=>{ pct = Math.min(95, pct+2); bar.style.width = pct+'%'; }, 200);
        await ffmpeg.load();
        clearInterval(timer);
        bar.style.width = '0%';
        statusEl.textContent = '';
      }
    }
    const CHAINS = {
      podcast:  'highpass=f=100,lowpass=f=12000,afftdn=nr=15',
      interview:'highpass=f=90,lowpass=f=12000,afftdn=nr=16',
      voiceover:'highpass=f=80,lowpass=f=12000,afftdn=nr=17',
      field:    'highpass=f=120,lowpass=f=11000,afftdn=nr=14'
    };

    processBtn.disabled = true;
    processBtn.addEventListener('click', async ()=>{
      if(!selectedFile) return;
      processBtn.disabled = true;
      downloadWrap.style.display='none';
      statusEl.textContent = T[lang].processing;
      bar.style.width='0%';

      try{
        await ensureFFmpegLoaded();

        const inExt  = (selectedFile.name.split('.').pop()||'wav').toLowerCase();
        const inFile = `in.${inExt}`;
        const out    = `cleaned.wav`;

        ffmpeg.FS('writeFile', inFile, await fetchFile(selectedFile));

        let fake = 0;
        const t = setInterval(()=>{ fake = Math.min(95, fake + 3); bar.style.width = fake+'%'; }, 300);

        const chain = CHAINS[preset] || CHAINS.podcast;
        await ffmpeg.run(
          '-hide_banner','-loglevel','error',
          '-i', inFile,
          '-vn','-sn','-ac','1','-ar','32000',
          '-af', chain,
          '-c:a','pcm_s16le',
          out
        );

        clearInterval(t);
        bar.style.width='100%';

        const data = ffmpeg.FS('readFile', out);
        const blob = new Blob([data.buffer], { type: 'audio/wav' });
        const url  = URL.createObjectURL(blob);
        dl.href = url;
        dl.download = (selectedFile.name.replace(/\.[^.]+$/, '') || 'cleaned') + '_cleaned.wav';
        downloadWrap.style.display='block';
        statusEl.textContent = T[lang].done;
        processBtn.disabled=false;
      }catch(e){
        console.error(e);
        statusEl.innerHTML = `<span class="err">${T[lang].error}: ${e?.message||e}</span>`;
        processBtn.disabled=false;
      }
    });

    // i18n старт
    applyLang();
  });
  </script>
</body>
</html>





